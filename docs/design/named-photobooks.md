# Создание PSD-шаблонов для именных фотокниг

## Подготовка шаблона
* Для данного редактора есть особые требования:
    + Для подстановки имени ребенка в какое-либо место шаблона, нужно использовать инструмент "Текст" (TypeTool). Важно использовать именно выделение области - так область будет позиционированной и никуда не сдвинется. Слой должен называться `[name]`.
    + Для подстановки текста в посвящение также используется инструмент "Текст".<br>Шаблон посвящения может содержать до трех блоков — заголовок, тело, подпись:
        - слой с заголовком должен называться `[title]`;
        - слой с основным текстом должен называться `[dedication]`;
        - слой с подписью должен называться `[sign]`.
* Как это работает: например, в шаблоне место, куда должно быть помещено имя ребенка (параметр `[name]`), выделяется с помощью инструмента "Текст". Слою присваивается имя `[name]`. Потом в данную область будет встраивать в соответствии с размерами имя.

## Разметка шаблона
* Редактор использует механизм подбора шаблонов для страниц книги на основе логических выражений. Механизм подбора работает до первого совпадения.
![](../_media/design/design31.png ':size=30%')
* После создания и загрузки шаблона нужно разметить его развороты. В поле "Доступен для поверхностей" каждого разворота надо вставить заранее составленное логическое выражение, для которого можно использовать следующие переменные:
    + `[index]` — переменная, обозначающая номер страницы.<br>Обратите внимание, что сама книга считается разворотами. Для корректной работы в значение данной переменной нужно ставить номер первой страницы разворота.<br>Например:
| строка ввода | пояснение |
|---|---|
| `[index] == 1` | обозначение для обложки |
| `[index] == 2` | обозначение для страницы посвящения |
| `[index] == 4`<br>или `[index] == 6`| обозначение для каких-либо других страниц книги|
* 
    + `[last]` — переменная, обозначающая номер последней страницы книги. Эта страница занята второй частью обложки, поэтому эта переменная используется для нумерации с конца книги.<br>Например:
| строка ввода | пояснение |
|---|---|
| `[index] == ([last] – 2)` | обозначение для третьей страницы с конца (последнего разворота перед задней обложкой)|
| `[index] == ([last] – 4)`<br>или `[index] == ([last] – 6)` | обозначение других страниц с конца книги|
* 
    + `[hair]` — переменная, обозначающая цвет волос ребенка. Обозначается цифрой и имеет три значения: "1" — блондин, "2" — брюнет, "3" — шатен.<br>Например:
| строка ввода | пояснение |
|---|---|
| `[hair] == 1` | обозначение, что данный шаблон доступен при выборе цвета волос "блондин" |
| `[hair] == 2` | обозначение, что данный шаблон доступен для цвета волос "брюнет" |
* 
    + `[gender]` — переменная, обозначающая пол ребенка. Имеет два значения: "b" — мальчик, "g" — девочка.<br>Например:
| строка ввода | пояснение |
|---|---|
| `[gender] == 'g'` | обозначение, что данный файл шаблона будет доступен при выборе пола "девочка" |
| `[gender] == 'b'` | ообозначение, что данный файл шаблона будет доступен при выборе пола "мальчик" |
* 
    + `[letter]` — переменная, обозначающая букву в имени ребенка.<br>Например:
| строка ввода | пояснение |
|---|---|
| `[letter] == 'д'` | обозначение, что данный файл шаблона будет доступен для страницы, которой соответствует буква "Д" в имени ребенка |
| `[letter] == 'u'` | обозначение, что данный файл шаблона будет доступен для страницы, которой соответствует буква "U" в имени ребенка |

!> Одинаковые по написанию латинские и кириллические буквы считаются разными (буквы "А" на латинице и кириллице пишутся одинаково, тем не менее редактор распознает их как разные).
* 
    + `[position]` — переменная, позволяющая позиционировать шаблоны в книге по буквам и разворотам. Используется совместно с `[letter]` для позиционирования букв имени внутри разворотов.
* В редакторе на каждую букву имени предусмотрено два разворота (четыре страницы). Учитываются и повторяющиеся в имени буквы.
* Переменная `[position]` должна состоять из двух цифр. Первая цифра обозначает порядковый номер одинаковых букв в слове в порядке их появления. Например, в имени "Александра" есть три буквы "А". Соответственно, первой "А" будет соответствовать цифра "1", второй — "2" и т. д.
* Вторая цифра обозначает номер разворота внутри буквы. Может принимать значение или "1", или "2", поскольку на каждую букву предусмотрено по два разворота. Соответственно, "1" — для первого разворота в букве, "2" — для второго.
* Например, для имени "Александра" могут быть выбраны шаблоны, содержащие следующие логические выражения:
| строка ввода | пояснение |
|---|---|
| `[letter] == 'a' && [position] == 11` | такое выражение означает, что данный файл шаблона доступен для первого разворота первой буквы "А" в данном имени |
| `[letter] == 'a' && [position] == 12` | файл шаблона доступен для второго разворота первой буквы "А" в данном имени |
| `[letter] == 'a' && [position] == 21` | файл шаблона доступен для первого разворота второй буквы "А" в данном имени |
| `[letter] == 'a' && [position] == 22` | файл шаблона доступен для второго разворота второй буквы "А" в данном имени и т.д. |

* Переменные связываются между собой __логическими операторами__:
    + __&&__ — обозначение для операции "И". Знак данной операции ставится между двумя выражениями переменных и подразумевает, что шаблон будет доступен для поверхности только при одновременном выполнении обоих условий.<br>Например:
| строка ввода | пояснение |
|---|---|
| `[index] == 1 && [hair] == 2` | обозначает, что файл шаблона доступен для обложки книги при выбранном цвете волос "брюнет" |
| `[gender] == 'g' && [hair] == 2 && [letter] == 'д' && [position] == 11 ` | файл шаблона доступен для первого (из двух) разворота первой буквы "Д" в имени, если цвет волос — "брюнет", а пол ребенка — "девочка" |
| `[gender] == 'b' && [hair] == 1 && [letter] == 'е' && [position] == 22` | файл шаблона доступен для второго (из двух) разворота второй буквы "Е" в имени, если цвет волос — "блондин", а пол ребенка — "мальчик" |
* 
    + __\|\|__ — обозначение для операции "ИЛИ". Знак данной операции ставится между двумя выражениями переменных и подразумевает, что шаблон будет доступен для поверхности только при выполнении одного из условий.<br>Например:
| строка ввода | пояснение |
|---|---|
| `[index] == 1 \|\| [hair] == 2` | файл шаблона доступен для обложки книги или при выбранном цвете волос "брюнет" |
| `[gender] == 'g' \|\| [hair] == 2` | файл шаблона доступен, если пол ребенка — "девочка" или цвет волос "брюнет" |
| `[gender] == 'b' \|\| [hair] == 1` | файл шаблона доступен, если пол ребенка — "мальчик" или цвет волос "блондин" |

* 
    + Вместе с логическими операторами допустимо использовать и простые __математические операции__: умножение (\*), деление нацело (/), сложение (+), вычитание (–), взятие остатка от деления (%).<br>Например:
| строка ввода | пояснение |
|---|---|
| `[index] % 2 == 0` | файл шаблона доступен, если номер страницы четный |
| `[index] / 2 == 10 \|\| [index] % 3 == 1` | файл шаблона доступен, если номер страницы — 20 (20 / 2 = 10) или если остаток от деления номера страницы на 3 равен 1 (значит подходят страницы с номерами 4, 7, 10, 13, 16 и т. д.) |

## Создание товара
* Для создания товара необходимо выполнить следующие действия:
    + В панели управления перейти в раздел "Печать / Продукты" и нажать "Добавить".
    + Создать категорию, выбрав в поле "Редактор" пункт "Редактор именных фотокниг".
    + Создать товар, нажав кнопку "Добавить" (рядом с надписью "Продукты").
    + В настройках товара отметить "Товар доступен на сайте".

## Настройка товара
* В настройках товара во вкладке "Основное" можно задать название продукта, описание, тиражность и др. Также внизу есть блок "Настройка обработки изображений", где можно указать определенное оборудование, которое будет использоваться при обработке файлов во время рендеринга заказа пользователя; формат выходного файла (.tiff, .jpeg, .png, .pdf); цветовой профиль, который будет применен к изображению.
* Вкладка "Редактор" содержит следующие настройки:
    + __Обязательные__:
        - __Качество отпечатка__  
        Данный пункт позволяет задать качество выходного изображения. По умолчанию там стоит значение 300 dpi.
        - __Настройка разворота/страниц__  
        В пункте "Размер (ширина × высота)" задаются размеры СТРАНИЦЫ книги. Шаблоны при показе в редакторе будут соответствовать данным параметрам?  
        Шаблон для показа в редакторе будет урезан по следующей схеме: наибольшая сторона согласно заданным настройкам будет выставлена в максимальное значение редактора, равное 500 px (1000 px для ширины, поскольку отображается книга разворотами).<br>Размер меньшей стороны соответствует следующей формуле:
        ![](../_media/design/design32.png ':size=70%')
        В редакторе все страницы, включая обложку, приводятся к данным размерам.<br>Также заданные размеры определяют размер выходного файла по следующей формуле:
        ![](../_media/design/design33.png ':size=70%')
        - __Настройка обложки__  
        В пункте "Размер страницы" задаются параметры обложки книги, которые влияют на размер выходного файла по следующей формуле:
        ![](../_media/design/design34.png ':size=70%')
        - __Настройки посвящения__  
        Здесь можно вписать текст посвящения "по умолчанию" и задать длину блоков, из которых формируется посвящение.
    + __Необязательные__:
        - __Настройка дополнительных страниц__  
        Здесь указывается количество дополнительных разворотов, а также место, где они будут располагаться: либо между посвящением (разворот после обложки) и началом разворотов с именем, либо между окончанием разворотов с именем и окончанием книги (последний разворот перед обложкой).
        - __Зоны отображения__   
        Здесь добавляются области, которые при показе в редакторе будут вырезаны из шаблона обложки и "склеены" в один разворот. Для каждой зоны указывается расположение на шаблоне и размеры в пикселях.

!> На печать всегда уходит шаблон целиком. Если области не указаны, шаблон обложки будет отображен для показа в редакторе полностью.