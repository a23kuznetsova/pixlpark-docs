# Интеграции с ERP и CRM системами

## Битрикс24

### Настройка интеграции
* Двусторонняя интеграция позволяет оперативно отслеживать состояние заказа в панели управления Pixlpark и в CRM-системе Битрикс24. 
> Примечание: интеграция работает только при переходе на платный тариф "Профессиональный", для которого доступен 15-дневный пробный период.
* Для настройки интеграции необходимо выполнить следующие действия.
* В разделе "__Приложения / Маркет / Разработчикам / Готовые решения / Другое__" создать входящий и исходящий вебхуки.
![](../_media/integration/bitrix01.png ':size=60%')
* В открывшемся окне содержиться информация вебхука в формате: 
```bash
https://название-компании.bitrix24.ru/rest/номер-сотрудника/вебхук/
```
![](../_media/integration/bitrix02.png ':size=60%')
* Затем необходимо заполнить форму, указав:
	+ __метод__ - выбрать метод "batch";
	+ __URL__ - адрес создается автоматически в формате 
	```bash
	https://название-компании.bitrix24.ru/rest/номер-сотрудника/вебхук/batch.json
	```
	+ "__Настройка прав__" - выбрать "CRM".


![](../_media/integration/bitrix03.png ':size=60%')
* И нажать кнопку "__Сохранить__" в нижней части экрана.
* Затем создать "__Исходящий вебхук__" (отправка данных из "Битрикс24" в Pixlpark) в разделе "__Приложения / Маркет / Разработчикам / Готовые решения / Другое__".
* Далее, в разделе "__Исходящий вебхук__" заполнить форму, указав:
	+ __URL вашего обработчика__ - сделать запись в формате 
	```bash
	https://ваш-сайт/api/bitrix/events
	```
	+ __События__ - выбрать "Обновление сделки", "Обновление контакта", "Обновление компании", "Обновление лида", "Удаление сделки", "Удаление контакта", "Удаление компании", "Удаление лида", "Удаление товара".


![](../_media/integration/bitrix04.png ':size=60%')
* И нажать кнопку "__Сохранить__" в нижней части экрана.
* Параллельно необходимо открыть в панели управления Pixlpark раздел "Заказы / Настройка / Выгрузка заказов" и в подразделе "ERP и CRM системы" включить "Битрикс24".
![](../_media/integration/bitrix05.png ':size=60%')
* Далее, перейти в раздел "__Приложения / Маркет / Разработчикам / Интеграции__", содержащий все созданные вебхуки.
* Затем скопировать поля из "Битрикс24" в Pixlpark:
	+ "__URL портала__" - внести адрес в формате:
	```bash
	https://название-компании.bitrix24.ru
	```
	+ __номер сотрудника__ из входящего вебхука в "__ID сотрудника, создавшего вебхуки__";
	+ "__Токен приложения__" исходящего вебхука в "__Токен исходящего вебхука__";
	+ __код входящего вебхука__ из "Вебхука для вызова rest api" входящего вебхука в "__Код входящего вебхука (batch)__";

* В завершении необходимо:
	+ выбрать оптимальный тип отправляемых запросов в "__Типы отправляемых запросов__" (см. описание ниже);
	+ выбрать направление сделки в "__Направлении сделки__" (см. описание ниже);
	+ указать "__ID ответственного за сделку сотрудника__" (заполняется при необходимости, см. описание ниже);
	+ включить "__Передача новых клиентов в Битрикс в качестве лидов__" (при необходимости);
	+ включить "__Использовать телефонию Битрикс24 на странице заказа в панели управления__" (при необходимости).


![](../_media/integration/bitrix06.png ':size=70%')
> Примечание: при отсутствии значения в поле "ID ответственного за сделку"  для всех сделок ответственным сотрудником будет назначается сотрудник, создавший вебхуки.
* Затем необходимо нажать на кнопку "Сохранить" и сбросить кеш сайта.
* В появившемся поле нужно настроить статусы заказов в Pixlpark и "Битрикс24" для выбранного типа отправляемых заказов:
![](../_media/integration/bitrix07.png ':size=70%')
* Далее, нажать на кнопку "__Сохранить__" и сбросить кеш сайта.
> Примечание: чтобы номер телефона и адрес электронной почты передавались в Pixlpark, при редактировании контакта необходимо для телефона указывать тип "Мобильный", а email - "Частный".
### Обмен данными при создании заказа
* После того как пользователь совершает заказ на сайте, он попадает в панель управления Pixlpark и в "Канбан" и "Список" раздела "CRM / Сделки" "Битрикс24" в виде сделки.
* Отображение заказа в панели управления Pixlpark:
![](../_media/integration/bitrix08.png ':size=60%')
* Отображение заказа на канбане в "Битрикс24":
![](../_media/integration/bitrix09.png ':size=60%')
* Отображение заказа в списке в "Битрикс24":
![](../_media/integration/bitrix10.png ':size=60%')
* Для просмотра содержимого заказа в "Битрикс24" нужно нажать на его номер. В верхней части открывшейся вкладки содержится информация о номере заказа, направлении сделки. Далее обозначены стадии работы по сделке, а также доступны подразделы с информацией о сделке.
![](../_media/integration/bitrix11.png ':size=70%')
* В подразделе "__О сделке__" содержится:
	+ "__Сумма и валюта__" - сумме и валюте заказа;
	+ "__Стадия__" - указывается стадия сделки согласно настройкам "Битрикс24";
	+ "__Клиент__" - контакты клиента (физического/юридического лица).

* Карточка физического лица:
![](../_media/integration/bitrix12.png 'size=50%')
* Карточка юридического лица:
![](../_media/integration/bitrix13.png ':size=50%')
* В подразделе "Дополнительно" содержится:
	+ "__Источник__" - источник, с которого был сделан заказ;
	+ "__Дополнительно об источнике__" - сайт, с которого был сделан заказ;
	+ "__Дата начала__" - дата создания заказа;
	+ "__Ответственный__" - ответственный за сделку сотрудник;
	+ "__Комментарий__" - ссылка на заказ и на архив с заказом;
	+ "__Лента обсуждения__" - комментарии к заказу из панели управления Pixlpark;
	+ "__Доставка__" - информация о способе доставке, который выбрал клиент.


![](../_media/integration/bitrix14.png ':size=50%')
* В подразделе "__Товары__" содержится:
	+ список товаров заказа с указанием их стоимости.


![](../_media/integration/bitrix15.png ':size=50%')
* Также информацию о товарах можно посмотреть в разделе "__Товары__" в меню информации о сделке.
![](../_media/integration/bitrix16.png ':size=60%')
### Дополнительные настройки
#### Задание типа отправляемых заказов в "Битрикс24"
* В случае необходимости, можно ограничить тип заказов, которые будут передаваться в "Битрикс24" в зависимости от типа клиента (физическое лицо / юридическое лицо / все клиенты). Для этого в настройках интеграции в подразделе "__Типы отправляемых заказов__" "__Битрикс24__"  раздела "__Заказы / Настройки / Выгрузка заказов / ERP и CRM системы__" необходимо выбрать нужный тип отправляемых заказов в "Битрикс24" из выпадающего списка.
![](../_media/integration/bitrix17.png ':size=60%')
#### Добавление Битрикс ID клиента в панели управления
Добавить Битрикс ID возможно при редактировании профиля клиента, указав реальный ID клиента в "Битрикс24" в поле "__Bitrix Contact ID__".
![](../_media/integration/bitrix18.png ':size=50%')


#### Смена направления создания сделки
* Направления сделки в "Битрикс24" позволяют разделять направления работы с клиентами,ведя одновременно несколько процессов продаж по разным сценариям, и при этом учитывать особенности индивидуального регламента и целей для каждого из направлений.
* Настройка осуществляется в подразделе "__Направление сделки__" "__Битрикс24__"  раздела "__Заказы / Настройки / Выгрузка заказов / ERP и CRM системы__". Предварительно в "Битрикс24" необходимо настроить соответствующее направление в "Воронках и туннелях продаж".
![](../_media/integration/bitrix19.png ':size=60%')
После внесения изменений необходимо нажать кнопку "Сохранить" и сбросить кеш сайта.

#### Назначение ответственных за сделку
* Данный функционал позволяет назначить сотрудника, ответственного за сделки, в панели управления Pixlpark.
* По умолчанию ответственным за сделку назначается администратор, осуществляющий настройку интеграции с профилем в "Битрикс24". Для назначения иного ответственного лица в карточке сделки необходимо навести указатель мыши на поле "Ответственный", нажать на появившуюся кнопку "Сменить" и выбрать необходимого сотрудника из списка. Внесенные изменения будут сохранены автоматически.
![](../_media/integration/bitrix20.png ':size=50%')
* Также в панели управления Pixlpark в настройках интеграции возможно задать ID сотрудника, ответственного за сделку. 
* ID сотрудника можно посмотреть в адресной строке карточки сотрудника. Для этого необходимо перейти в раздел "Компания", а затем открыть профиль сотрудника. При этом в браузере отразится адрес в формате:
```bash
https://названиекомпании.bitrix24.ru/company/personal/user/ID-сотрудника/
```
* Далее, в подразделе "Битрикс24" раздела "__Заказы / Настройка / Выгрузка заказов / ERP и CRM системы__" указать номер сотрудника в "ID ответственного за сделку".
![](../_media/integration/bitrix21.png ':size=50%')
Затем нажать кнопку "Сохранить" и сбросить кеш сайта.
#### Импорт новых клиентов из панели управления Pixlpark
* Благодаря включению механизма лидов в настройке интеграции, все новые пользователи (физические лица / организации) становятся лидами в "Битрикс24". Новый лид отображается в разделе "__CRM / Лиды__". При оформлении заказа новыми пользователями  данные о заказе указывается в созданном лиде "Битрикс24". 
* Отображение созданного новым пользователем заказа в панели управления.
![](../_media/integration/bitrix22.png ':size=50%')
* Отображение лида при регистрации пользователя и оформлении им заказа.
![](../_media/integration/bitrix23.png ':size=40%')
* Для формирования сделки с заказом необходимо вручную перевести лид в "Качественный лид".
![](../_media/integration/bitrix24.png ':size=50%')
* Затем во всплывающем окне выбрать, что именно нужно создать на основании данного лида.
![](../_media/integration/bitrix25.png ':size=20%')
* Затем указать направление сделки и заполнить вручную поля заказа:
	+ "Лента обсуждений";
	+ "Доставка". 
 
* После этого будет создана новая сделка с заказом в разделе "__CRM / Сделки__" и новый контакт.
![](../_media/integration/bitrix26.png ':size=50%')
Сформированная сделка с заказом от зарегистрированного клиента после обработки лида.
* В случае регистрации юридического лица создается 2 лида: 
	+ лид организации;
	+ лид сотрудника организации (в нем размещается совершенный заказ). 


![](../_media/integration/bitrix27.png ':size=40%')
* После перевода лида с заказом в "Качественный лид" во всплывающем окне необходимо выбрать "Сделка + Контакт + Компания". После этого будет сформирована новая сделка от юридического лица (компании) с контактами сотрудника в разделе "__CRM / Сделки__". Также будут созданы контакт сотрудника в разделе "__CRM / Контакты__"  и карточка компании в разделе "__CRM / Компании__".
![](../_media/integration/bitrix28.png ':size=40%')
* В случае создания профиля организации через панель управления, у сотрудника компании не должно быть статуса "Гость".
> Примечание: лид компании в разделе "CRM / Лиды" обрабатывается автоматически.
#### Импорт ранее зарегистрированных клиентов из панели управления Pixlpark
* Когда данные юридического лица необходимо отправить из панели управления Pixlpark в "Битрикс24" вручную, необходимо в панели управления Pixlpark в подразделе "__Основная информация__" раздела  "__Клиенты / Организации__" нажать кнопку "__Отправить в Bitrix24__". 
![](../_media/integration/bitrix29.png ':size=70%')
> Примечание: кнопка будет доступна если компания ранее не зарегистрирована в Вашем профиле "Битрикс24".
* После импорта компании информация о ней будет доступна в разделе "CRM / Компании".
* В панели управления в подразделе "__Инфо__" раздела  "__Клиенты / Организации__" будет доступно поле "Bitrix ID" с указанием ID данной организации в вашем профиле "Битрикс24".
![](../_media/integration/bitrix30.png ':size=70%')

 


